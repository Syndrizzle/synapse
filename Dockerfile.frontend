ARG VITE_API_BASE_URL
ARG VITE_UPLOAD_TIMEOUT
ARG __VITE_ADDITIONAL_SERVER_ALLOWED_HOSTS

FROM node:18-alpine

WORKDIR /app

RUN apk add --no-cache curl

COPY package*.json ./

RUN npm install -g pnpm

RUN pnpm install

COPY . .

RUN pnpm build

EXPOSE 5173

ENV VITE_API_BASE_URL=$VITE_API_BASE_URL
ENV VITE_UPLOAD_TIMEOUT=$VITE_UPLOAD_TIMEOUT
ENV __VITE_ADDITIONAL_SERVER_ALLOWED_HOSTS=$__VITE_ADDITIONAL_SERVER_ALLOWED_HOSTS

CMD ["pnpm", "preview", "--host", "--port", "5173"]